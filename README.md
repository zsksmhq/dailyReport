# SHU_dailyReport

**ä»…ä¾›äº¤æµå­¦ä¹ **  
æ„Ÿè°¢YMZLTå¤§ä½¬ï¼ï¼
# é¡¹ç›®ç®€ä»‹

  è¯¥é¡¹ç›®åŸºäºpythonçš„requeståº“å’Œbs4åº“å®ç°ä¸Šæµ·å¤§å­¦çš„è‡ªåŠ¨æŠ¥é€ã€‚å¯éƒ¨ç½²äºæœåŠ¡å™¨æˆ–è€…GitHub Actionæ¥å®ç°æ¯å¤©è‡ªåŠ¨æŠ¥é€ã€‚  

  - report.py å¯è‡ªè¡Œåˆ¤æ–­æ˜¯å¦åœ¨æ ¡ï¼Œç¦»æ ¡ç”Ÿçš„æŠ¥é€ä¿¡æ¯ï¼ˆåœ°å€ç­‰ï¼‰æ ¹æ®ä¸Šæ¬¡æŠ¥é€ä¿¡æ¯å¡«å†™ã€‚ç”±äºç”¨åˆ°æ­£åˆ™åŒ¹é…ä¹‹å‰çš„æŠ¥é€ä¿¡æ¯ï¼Œæ‰€ä»¥ç½‘ç«™ä¿¡æ¯æ›´æ–°åé¡¹ç›®å¯èƒ½ä¼šå¤±æ•ˆã€‚
  - oneReport.py ç”¨äºç¦»æ ¡ä»¥åå½“å¤©çš„æ¯æ—¥ä¸€æŠ¥ï¼›
  - twoReport.py ç”¨äºåœ¨æ ¡ç”Ÿå½“å¤©çš„æ¯æ—¥ä¸¤æŠ¥ï¼›
  - delayReport.py ç”¨äºä¸€æ¬¡æ€§è¡¥æŠ¥ä¹‹å‰æ—¥æœŸã€‚ï¼ˆç›®å‰æ²¡æ³•ç”¨ï¼Œä¼šå°½å¿«åŠ ä¸Šï¼‰

  ä»¥ä¸Šå››ä¸ªè„šæœ¬æ–‡ä»¶éƒ½å¯å•ç‹¬è¿è¡Œï¼Œå¯æ ¹æ®éœ€è¦é€‰æ‹©ã€‚
  
  

## æœ¬åœ°æŠ¥é€å’Œè¡¥æŠ¥

1. æŠŠä»£ç cloneåˆ°æœ¬åœ°

   ```
   https://github.com/zsksmhq/dailyReport.git
   ```
2. å®‰è£…ä¾èµ–åº“ï¼ˆè§requirements.txt)
3. è¿è¡Œreport.pyè¿›è¡Œå½“æ—¥æŠ¥é€
   ```python
   python delayReport.py å­¦å· å¯†ç  è¡¥æŠ¥å¤©æ•°
   ```
5. è¿è¡ŒOneReport.pyè¿›è¡Œæ¯æ—¥ä¸€æŠ¥å½“æ—¥æŠ¥é€
   ```python
   python twoReport.py å­¦å· å¯†ç  è¯¦ç»†åœ°å€
   ```
   è¯¦ç»†åœ°å€éœ€è¦æä¾›æ‰€åœ¨åœ°çš„çœã€å¸‚ã€å¿/åŒºã€å…·ä½“ä½å€,ç”¨é€—å·åˆ†éš”ï¼ˆæ³¨æ„æ˜¯è‹±æ–‡é€—å·ï¼Œçœä»½ä¸è¦åŠ çœå­—ï¼‰
   ä¾‹å¦‚ï¼š
   
   ```python
   python twoReport.py 1812**** 12345678 å®‰å¾½,åˆè‚¥å¸‚,è‚¥ä¸œå¿,è‚¥ä¸œä¸€ä¸­
   ```
6. è¿è¡ŒtwoReport.pyè¿›è¡Œæ¯æ—¥ä¸¤æŠ¥å½“æ—¥æŠ¥é€
   ```python
   python twoReport.py å­¦å· å¯†ç 
   ```

## GitHub Actionè‡ªåŠ¨æŠ¥é€

### 1ã€æŠŠä»£ç forkåˆ°ä½ çš„ä»“åº“

### 2ã€é‚®ç®±é…ç½®ï¼ˆå¯é€‰ï¼‰

github action å®ç°è‡ªåŠ¨å‘é‚®ä»¶éœ€è¦ä¸€ä¸ªé…ç½®SMTPæœåŠ¡çš„é‚®ç®±ï¼ˆqqé‚®ç®±ã€163é‚®ç®±ç­‰ï¼‰ã€‚ä»¥é…ç½®163é‚®ç®±ä¸ºä¾‹ï¼Œå…ˆç™»å½•é‚®ç®±ï¼Œç‚¹å‡»è®¾ç½®ï¼Œé€‰æ‹©POP3/SMTP/IMAP,ç„¶åå¼€å¯SMTPæœåŠ¡ã€‚
![1](images/1.png)
å¼€å¯æœåŠ¡åä¼šç”Ÿæˆä¸€ä¸ªä¸“ç”¨æˆæƒå¯†ç ï¼Œå°†è¯¥å¯†ç è®°å½•ä¸‹æ¥ï¼Œç”¨äºä¸‹é¢çš„Secretsé…ç½®ã€‚

### 3ã€Secrets é…ç½®

è¿›å…¥è‡ªå·± fork çš„ä»“åº“ï¼Œç‚¹å‡» Settings-> Secrets-> New Secretsï¼Œ æ·»åŠ  1 ä¸ª Secretsï¼Œå…¶åç§°ä¸º`STUDENTID`ï¼Œå€¼ä¸ºè‡ªå·±çš„å­¦å·ã€‚å®ƒä»¬å°†ä½œä¸ºé…ç½®é¡¹ï¼Œåœ¨åº”ç”¨å¯åŠ¨æ—¶ä¼ å…¥ç¨‹åºã€‚ç„¶åå†æ·»åŠ ä¸€ä¸ªSecretsï¼Œ`PASSWORD`å€¼ä¸ºè‡ªå·±çš„å¯†ç ã€‚
![2](./images/2.png)

å¦‚æœéœ€è¦å‘é€é‚®ä»¶çš„è¯è¿˜éœ€è¦é…ç½®ä¸‹é¢ä¸‰ä¸ª Secretsï¼š

  - `MAIL_USERNAME` è‡ªåŠ¨å‘é‚®ä»¶çš„é‚®ç®±å·
  - `MAIL_PASSWORD` è‡ªåŠ¨å‘é‚®ä»¶çš„é‚®ç®±æˆæƒå¯†ç ï¼Œå°±æ˜¯å¼€é€šé‚®ç®±STMTPæœåŠ¡æ—¶è®°å½•ä¸‹æ¥çš„å¯†ç 
  - `MAIL_BOX` æ¥å—é‚®ä»¶çš„é‚®ç®±å·

å¦‚æœä¸ºæ¯æ—¥ä¸€æŠ¥çš„è¯è¿˜éœ€è¦é…ç½®æ‰€åœ¨åœ°å€çš„ Secretsï¼š

  - `LOCATION`    æ‰€åœ¨åœ°çš„è¯¦ç»†åœ°å€(éœ€è¦æä¾›æ‰€åœ¨åœ°çš„çœã€å¸‚ã€å¿/åŒºã€å…·ä½“ä½å€,ç”¨é€—å·åˆ†éš”)s
    ä¾‹å¦‚ï¼šå®‰å¾½,åˆè‚¥å¸‚,è‚¥ä¸œå¿,è‚¥ä¸œä¸€ä¸­
    æ³¨æ„ï¼šåˆ†éš”ç¬¦ä¸ºè‹±æ–‡é€—å·ï¼Œçœä»½ä¸éœ€è¦åŠ çœå­—

### 4ã€æ‰‹åŠ¨è¿è¡Œå·¥ä½œæµ
éƒ½é…ç½®å¥½åï¼Œè¯·æ‰‹åŠ¨å¼€å¯ Actionsï¼Œæ‰§è¡Œä¸€æ¬¡å·¥ä½œæµï¼ŒéªŒè¯æ˜¯å¦å¯ä»¥æ­£å¸¸å·¥ä½œï¼Œæ“ä½œæ­¥éª¤å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

![Actionså›¾ç¤º](./images/3.png)

è¿è¡Œç»“æŸåï¼Œå¯æŸ¥çœ‹è¿è¡Œæ—¥å¿—ï¼š

![Actionsæ—¥å¿—å›¾ç¤º](./images/4.png)
![Actionsæ—¥å¿—å›¾ç¤º](./images/5.png)


- report é»˜è®¤æ˜¯æ¯å¤©0ç‚¹å’Œ16ç‚¹æ•´è§¦å‘è¿è¡Œ;
- oneReport é»˜è®¤æ˜¯æ¯å¤©0æ•´è§¦å‘è¿è¡Œ;
- twoReport é»˜è®¤æ˜¯æ¯å¤©0ç‚¹å’Œ16ç‚¹æ•´è§¦å‘è¿è¡Œ;

å¯ä»¥æ ¹æ®éœ€è¦é€‰æ‹©å¯¹åº”çš„å·¥ä½œæµè¿è¡Œã€‚

å› ä¸ºgithub actionè‡ªèº«çš„åŸå› ï¼Œæ¯æ¬¡è¿è¡Œä¼šæœ‰**åŠä¸ªå°æ—¶å·¦å³çš„å»¶è¿Ÿ**ã€‚å¦å¤–å¦‚æœæƒ³è¦è®¾ç½®è‡ªå·±çš„è¿è¡Œæ—¶é—´ï¼Œè¯¦è§ä¸‹é¢**å¸¸è§é—®é¢˜**ã€‚

### 5ã€è¿è¡Œç»“æŸåï¼Œä¼šæœ‰é‚®ä»¶å‘é€
![9](images/9.png)

## å¸¸è§é—®é¢˜

### 1ã€ä¸æƒ³æ¥æ”¶é‚®ä»¶

ä¸æƒ³æ¥æ”¶é‚®ä»¶çš„è¯ï¼Œåˆ é™¤.github/workflowsä¸­çš„oneReport.ymlæˆ–twoReport.ymlä¸­ä¸‹é¢çš„éƒ¨åˆ†ä»£ç ï¼ŒåŒæ—¶åœ¨secretsä¸­ä¸é…ç½®é‚®ç®±ã€‚
```shell
# æ‰§è¡Œ
      - name: 'execute report'
        run: python report.py ${{ secrets.STUDENTID }} ${{ secrets.PASSWORD }} ${{ secrets.LOCATION }}
        
      # è·å–æ ¼å¼åŒ–çš„æ—¥æœŸå¹¶å­˜å…¥GitHubå†…ç½®çš„ç¯å¢ƒå˜é‡ä¸­
      - name: 'Get Date'
        run: echo "REPORT_DATE=$(TZ=':Asia/Shanghai' date '+%Y-%m-%d %T')" >> $GITHUB_ENV
      
      # å‘é€é‚®ä»¶
      - name: 'Send mail'
        uses: dawidd6/action-send-mail@master
        with:
          # è¿™äº›æ˜¯å‘é€é‚®ä»¶éœ€è¦é…ç½®çš„å‚æ•°ï¼Œæ›´å¤šè¯¦ç»†çš„è¯´æ˜è¯·è®¿é—®å…·ä½“çš„ä»“åº“
          server_address: smtp.163.com
          server_port: 465
          # è¿™äº›secretçš„ç¯å¢ƒå˜é‡éœ€è¦é…ç½®åœ¨settingä¸­çš„secretä¸‹
          username: ${{ secrets.MAIL_USERNAME }}
          password: ${{ secrets.MAIL_PASSWORD }}
          subject: æ¯æ—¥ä¸€æŠ¥ (${{env.REPORT_DATE}})
          body: "æ¯æ—¥ä¸€æŠ¥ æŠ¥é€æˆåŠŸ"
          to: ${{ secrets.MAIL_BOX }}
          from: GitHub Actions
          content_type: text/html
```
### 2ã€ä¿®æ”¹è¿è¡Œæ—¶é—´report

æ¯æ—¥ä»»åŠ¡æ‰§è¡Œçš„æ—¶é—´ï¼Œç”±.github/workflowsä¸­çš„oneReport.ymlæˆ–twoReport.ymlä¸­çš„cronè¡¨è¾¾å¼æŒ‡å®šï¼Œæ¯æ—¥ä¸¤æŠ¥é»˜è®¤ä¸ºæ¯æ—¥çš„0ç‚¹æ•´å’Œ16ç‚¹:

```yml
schedule: # å®šæ—¶è§¦å‘
    # cronè¡¨è¾¾å¼ï¼Œæ—¶åŒºæ˜¯UTCæ—¶é—´ï¼Œæ¯”æˆ‘ä»¬æ—©8å°æ—¶ï¼Œå¦‚ä¸‹æ‰€è¡¨ç¤ºçš„æ˜¯16è¡¨ç¤ºçš„æ˜¯æ¯å¤©0ç‚¹0åˆ†
    - cron: '0,0 16,8 * * *'
```

**è‹¥è¦ä¿®æ”¹ä¸ºè‡ªå·±æŒ‡å®šçš„æ—¶é—´æ‰§è¡Œï¼Œæœ‰å¦‚ä¸‹ä¸¤ç§æ–¹å¼ï¼š**

- æ–¹æ³•ä¸€ï¼šä¿®æ”¹yamlæ–‡ä»¶ä¸­çš„cronè¡¨è¾¾å¼
  æˆ‘ä»¬å¯ä»¥ç›´æ¥ä¿®æ”¹ä¸Šè¿°è¯¥æ–‡ä»¶ä¸­çš„cronè¡¨è¾¾å¼ï¼Œç„¶åæäº¤ã€‚

ä¸ªäººä¸å»ºè®®è¿™ä¹ˆåšï¼Œå› ä¸ºä»¥åæ›´æ–°è¦æ³¨æ„å†²çªä¸è¦†ç›–é—®é¢˜ï¼Œå»ºè®®ä½¿ç”¨ä¸‹é¢çš„æ–¹æ³•äºŒã€‚

- æ–¹æ³•äºŒï¼šæ·»åŠ  GitHub Environments å¹¶è®¾ç½®å»¶æ—¶
  v1.1.3åŠä¹‹åç‰ˆæœ¬ï¼Œæ”¯æŒé€šè¿‡æ·»åŠ GitHub Environmentsæ¥è®¾ç½®å»¶æ—¶è¿è¡Œï¼Œå³åœ¨æ¯æ—¥0ç‚¹æ•´è§¦å‘ Actions åï¼Œä¼šå†å¤šæ‰§è¡Œä¸€ä¸ªå»¶æ—¶æ“ä½œï¼Œå»¶æ—¶æ—¶é•¿å¯ç”±æˆ‘ä»¬è‡ªå·±è®¾ç½®ã€‚

  æ¯”å¦‚æƒ³è®¾ç½®ä¸ºæ¯å¤©8ç‚¹æ‰§è¡Œï¼Œåªéœ€è¦å°†è¿™ä¸ªå»¶æ—¶æ—¶å¸¸è®¾ç½®ä¸º480åˆ†é’Ÿï¼ˆ8ä¸ªå°æ—¶ï¼‰å³å¯ã€‚æ–¹æ³•å¦‚ä¸‹ï¼š

  - â… . æ‰¾åˆ° Production Environments
    		è¿è¡Œå®ŒtwoReport.yml ä¹‹åï¼Œåœ¨ Settings â€”â€”> Environments ä¸­ä¼šè‡ªåŠ¨å¤šå‡ºä¸€ä¸ªåä¸º Production çš„ç¯å¢ƒï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š
    ![Actions1](./images/6.png)
  - â…¡.è®¾ç½®å»¶æ—¶æ—¶é•¿
    å‹¾é€‰ Wait timerï¼Œå¹¶å¡«å†™å»¶æ—¶æ—¶é•¿ï¼Œå•ä½ä¸ºåˆ†é’Ÿï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š
    ![Actions2](./images/7.png)

  è®¾ç½®æˆåŠŸåï¼Œå†æ¬¡è¿è¡Œ Actions ä¼šå‘ç°è§¦å‘åä¼šè‡ªåŠ¨è¿›å…¥å€’è®¡æ—¶çŠ¶æ€ï¼Œç­‰å€’è®¡æ—¶ç»“æŸ(è¿™é‡Œæˆ‘è®¾ç½®çš„æ˜¯1åˆ†é’Ÿ)åæ‰ä¼šçœŸæ­£è¿è¡Œä¹‹åçš„å†…å®¹ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š
  ![Actions3](./images/8.png)

### 3ã€åœæ­¢è¿è¡Œ

ä¹‹åè¦æ˜¯ä¸éœ€è¦æ¯å¤©å¡«æŠ¥äº†ï¼Œé‚£è¿›å…¥setting->action->é€‰æ‹©Disable Actions for this repositoryã€‚è¯¥ä»“åº“çš„æ‰€æœ‰çš„å·¥ä½œæµå°†ä¸å†è¿è¡Œã€‚
å¦‚æœåªåœæ­¢ä¸€ä¸ªå·¥ä½œæµï¼Œå¯ä»¥ç›´æ¥åœ¨ Actions ä¸­è®¾ç½®ï¼šğŸ‘‡
![åœæ­¢è¿è¡Œ](./images/10.png)
## æ–‡ä»¶è¯´æ˜
>dailyReport:.
â”‚  delayReport.py è¡¥æŠ¥è„šæœ¬
â”‚  oneReport.py æ¯æ—¥ä¸€æŠ¥è„šæœ¬v2
â”‚  README.md è¯´æ˜æ–‡æ¡£
â”‚  report.py è‡ªåŠ¨åˆ¤æ–­æ¯æ—¥ä¸€æŠ¥/æ¯æ—¥ä¸¤æŠ¥
â”‚  report_at_school.py æ¯æ—¥ä¸¤æŠ¥è„šæœ¬v1
â”‚  report_leave_school.py æ¯æ—¥ä¸€æŠ¥è„šæœ¬v1
â”‚  request2json.py å°†æˆªè·çš„postè¡¨å•è½¬æˆjsonæ ¼å¼
â”‚  requirements.txt å®‰è£…ä¾èµ–
â”‚  see_FState.py ç”¨æ¥çœ‹fstateå€¼
â”‚  twoReport.py æ¯æ—¥ä¸¤æŠ¥è„šæœ¬v2
â”‚
â”œâ”€.github
â”‚  â””â”€workflows
â”‚          oneReport.yml æ¯æ—¥ä¸€æŠ¥å·¥ä½œæµ
â”‚          report.yml è‡ªåŠ¨åˆ¤æ–­æ¯æ—¥ä¸€æŠ¥/æ¯æ—¥ä¸¤æŠ¥å·¥ä½œæµ
â”‚          twoReport.yml æ¯æ—¥ä¸¤æŠ¥å·¥ä½œæµ
â”‚
â”œâ”€.idea
â”‚
â”œâ”€data  
â”‚      data.json ä»æŠ¥é€é¡µé¢æˆªè·çš„bodyè½¬æˆçš„è¡¨å•æ•°æ®
â”‚      F_State.json è¡¨å•æ•°æ®ä¸­çš„çŠ¶æ€æ•°æ®ï¼ˆè§£ç åçš„æ•°æ®ï¼‰
â”‚      requestBody.txt ä»æŠ¥é€é¡µé¢æˆªè·çš„body
â”‚
â”œâ”€images æ–‡æ¡£å›¾ç‰‡
## å‚è€ƒé“¾æ¥

[GitHub Actions å…¥é—¨æ•™ç¨‹](http://www.ruanyifeng.com/blog/2019/09/getting-started-with-github-actions.html)

[BiliBiliTool](https://github.com/RayWangQvQ/BiliBiliTool)

[GitHub Actions æ•™ç¨‹ï¼šå®šæ—¶å‘é€å¤©æ°”é‚®ä»¶](http://www.ruanyifeng.com/blog/2019/12/github_actions.html)

[Pythonå®ç°è‡ªåŠ¨ç­¾åˆ°è„šæœ¬](https://blog.csdn.net/ydydyd00/article/details/80882183)

[æ‰‹åŠ¨è§¦å‘ GitHub Actions çš„å‡ ç§æ–¹å¼](https://p3terx.com/archives/github-actions-manual-trigger.html)
